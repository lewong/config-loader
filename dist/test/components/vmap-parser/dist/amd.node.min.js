!function(a,b){"object"==typeof exports?module.exports=b(require("lodash")):"function"==typeof define&&define.amd&&define(["lodash"],b)}(this,function(a){function b(a){return Number(a.toString().match(/^\d+(?:\.\d{0,2})?/))}function c(a){var c=a.split(/\D/);return 60*+c[0]*60+60*+c[1]+ +c[2]+(c[3]?parseFloat("."+b(c[3])):0)}function d(b){a.isString(b)&&(b=parseFloat(b,10));var c=Math.floor(b/3600),d=b%3600,e=Math.floor(d/60),f=d%60;f=Math.round(100*f)/100,c>12&&(c-=12),10>c&&(c="0"+c),10>e&&(e="0"+e),10>f&&(f="0"+f);var g=c+":"+e+":"+f;return g}function e(b,c){var d=[];return(a.isObject(b)||a.isArray(b))&&a.each(b,function(b,f){f===c&&d.push(b),(a.isObject(b)||a.isArray(b))&&(d=d.concat(e(b,c)))}),d}function f(a){var b=e(a,"Duration");return c(b[0])}function g(a){var b=e(a,"ClickThrough");return b.length>0?b[0]:null}function h(a,b,c){if(0===b.indexOf("xmlns"))delete c[b];else{var d=b.split(":");0===b.indexOf("@")||0===b.indexOf("#")?(c[b.slice(1)]=a,delete c[b]):2===d.length&&(c[d[1]]=a,delete c[b])}}function i(b){a.each(a.rest(a.toArray(arguments)),function(c){var d=b[c];a.isArray(d)?a.each(d,function(b){a.each(b,h)}):a.each(d,h)})}function j(a){return a===p?m:a===q?o:n}function k(a,b){switch(a){case"firstQuartile":return b/4;case"midpoint":return b/2;case"thirdQuartile":return 3*b/4;case"complete":return b}}function l(b,c,d,e,f){a.each(d,function(d){a.each(d,h);var g=parseFloat(d.offset,10),i={breakId:b,event:d.event,url:d.text};isNaN(g)&&(g=k(d.event,c)),isNaN(g)||(i.timeToFire=Math.round(e+g)),f.push(i)})}var m="preroll",n="midroll",o="postroll",p="start",q="end",r={find:e,clean:h,process:function(d){function k(c,d,i){var k=o+parseFloat(i,10);i===q&&(k=m-r);var p;return a.each(d,function(d){var i=d.AdSource;a.each(i,h);var m=f(i.VASTData.VAST.Ad),q=a.isUndefined(p)?k:p;p=q+m,o+=m,l(i.id,m,a.flatten(e(i,"Tracking")),q,n);var r={type:j(d.timeOffset),breakId:i.id,startTime:b(q),endTime:b(p),timeOffset:d.timeOffset,duration:b(m)},s=g(i);s&&(r.clickThrough=s),c.push(r)}),c}if(!d)return{error:"vmap undefined"};var m,n=[],o=0,r=0;d=d["vmap:VMAP"],a.each(d,h),i(d,"AdBreak","Extensions"),i(d.Extensions,"unicornOnce","requestParameters"),m=parseFloat(d.Extensions.unicornOnce.payloadlength,10),!a.isArray(d.AdBreak)&&a.isObject(d.AdBreak)&&(d.AdBreak=[d.AdBreak]);var s=a.reduce(a.groupBy(d.AdBreak,function(a){return a.timeOffset===p?0:a.timeOffset===q?(r+=f(a),q):c(a.timeOffset)}),k,[]);return{uri:d.Extensions.unicornOnce.contenturi,timedTextURL:d.Extensions.timedTextURL["#cdata-section"],contentDuration:b(parseFloat(d.Extensions.unicornOnce.contentlength,10)),totalDuration:b(m),trackers:n,adBreaks:s}},rawTime:c,formatTime:d,version:"Thu May 08 2014 17:22:13",build:"0.3.1"};return r});