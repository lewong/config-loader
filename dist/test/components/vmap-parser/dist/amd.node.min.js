!function(a,b){"object"==typeof exports?module.exports=b(require("lodash")):"function"==typeof define&&define.amd&&define(["lodash"],b)}(this,function(a){function b(a){return Math.round(100*a)/100}function c(a){var c=a.split(/\D/);return 60*+c[0]*60+60*+c[1]+ +c[2]+(c[3]?parseFloat("."+b(c[3])):0)}function d(b){a.isString(b)&&(b=parseFloat(b,10));var c=Math.floor(b/3600),d=b%3600,e=Math.floor(d/60),f=d%60;f=Math.round(100*f)/100,c>12&&(c-=12),10>c&&(c="0"+c),10>e&&(e="0"+e),10>f&&(f="0"+f);var g=c+":"+e+":"+f;return g}function e(b,c){var d=[];return(a.isObject(b)||a.isArray(b))&&a.each(b,function(b,f){f===c&&d.push(b),(a.isObject(b)||a.isArray(b))&&(d=d.concat(e(b,c)))}),d}function f(a){var b=e(a,"Duration");return c(b[0])}function g(a){var b=e(a,"ClickThrough");return b.length>0?b[0]:null}function h(a,b,c){if(0===b.indexOf("xmlns"))delete c[b];else{var d=b.split(":");0===b.indexOf("@")||0===b.indexOf("#")?(c[b.slice(1)]=a,delete c[b]):2===d.length&&(c[d[1]]=a,delete c[b])}}function i(b){a.each(a.rest(a.toArray(arguments)),function(c){var d=b[c];a.isArray(d)?a.each(d,function(b){a.each(b,h)}):a.each(d,h)})}function j(a){return"start"===a?m:"end"===a?o:n}function k(a,b){switch(a){case"firstQuartile":return b/4;case"midpoint":return b/2;case"thirdQuartile":return 3*b/4;case"complete":return b}}function l(b,c,d,e,f){a.each(d,function(d){a.each(d,h);var g=parseFloat(d.offset,10),i={breakId:b,event:d.event,url:d.text};isNaN(g)&&(g=k(d.event,c)),isNaN(g)||(i.timeToFire=Math.round(e+g)),f.push(i)})}var m="preroll",n="midroll",o="postroll",p={find:e,clean:h,process:function(b){function d(b,c,d){var i=n+parseFloat(d,10);"end"===d&&(i=k-o);var q=[];return a.each(c,function(c){var d=c.AdSource;a.each(d,h);var k=f(d.VASTData.VAST.Ad),o=a.isEmpty(q)?i:a.last(q)+1,p=o+k;n+=k,q=q.concat(a.range(Math.ceil(o),Math.floor(p))),l(d.id,k,a.flatten(e(d,"Tracking")),o,m);var r={type:j(c.timeOffset),breakId:d.id,startTime:o,endTime:p,timeOffset:c.timeOffset,duration:k},s=g(d);s&&(r.clickThrough=s),b.push(r)}),p.push(a.flatten(q)),b}if(!b)return{error:"vmap undefined"};var k,m=[],n=0,o=0,p=[];b=b["vmap:VMAP"],a.each(b,h),i(b,"AdBreak","Extensions"),i(b.Extensions,"unicornOnce","requestParameters"),k=parseFloat(b.Extensions.unicornOnce.payloadlength,10);var q=a.reduce(a.groupBy(b.AdBreak,function(a){return"start"===a.timeOffset?0:"end"===a.timeOffset?(o+=f(a),"end"):c(a.timeOffset)}),d,[]);return{uri:b.Extensions.unicornOnce.contenturi,contentDuration:parseFloat(b.Extensions.unicornOnce.contentlength,10),totalDuration:k,trackers:m,adBreaks:q}},rawTime:c,formatTime:d,version:"Mon Mar 03 2014 16:35:43",build:"0.1.0"};return p});