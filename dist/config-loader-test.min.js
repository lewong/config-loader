var Request=function(a,b,c){var d=this.request=new XMLHttpRequest;d.open("GET",a,!0),d.setRequestHeader("Accept","application/json"),d.onload=function(){if(d.status>=200&&d.status<400){var e,f;try{e=JSON.parse(d.responseText)}catch(g){f=g}e?b(e):c(f)}else c("Load Error, http status:"+d.status+" for "+a)},d.onerror=function(){c("Load Error, http status:"+d.status+" for "+a)},d.send()};Request.prototype={abort:function(){this.request.abort()}};var EventEmitter={convert:function(a,b){return b={},a.on=function(c,d){return(b[c]=b[c]||[]).push(d),a},a.once=function(b,c){function d(){c.apply(a.off(b,d),arguments)}return d.h=c,a.on(b,d)},a.off=function(c,d){for(var e=b[c],f=0;d&&e&&e[f];f++)e[f]!==d&&e[f].h!==d||e.splice(f--,1);return f||delete b[c],a},a.emit=function(c){for(var d=b[c],e=0;d&&d[e];)d[e++].apply(a,d.slice.call(arguments,1));return a},a}},MediaGen={MEDIA_GEN_ERROR:"mediaGenError",getItem:function(a){return a&&a.item?a.item:a.video.item},isVideoItem:function(a){return _.isObject(a.vmap)||_.isObject(a.rendition)||_.isArray(a.rendition)},process:function(a){_.isString(a)&&(a=JSON.parse(a));var b,c=this.getItem(a.package);return _.isArray(c)?(b=_.find(c,this.isVideoItem),b&&(b.overlay=_.find(c,function(a){return"overlay"===a.placement}))):this.isVideoItem(c)&&(b=c),b||_.some(c,function(a){if("text"===a.type)throw{name:MediaGen.MEDIA_GEN_ERROR,message:a.text}}),b.vmap&&(b.vmap=VMAPParser.process(b.vmap),b.image&&Segments.process(b.vmap.adBreaks,b.image)),b}},Segments={process:function(a,b){return Segments.adjustForAds(a,Segments.configureSegments(b))},configureSegments:function(a){var b=0,c=function(a){return Number(a.toString().match(/^\d+(?:\.\d{0,2})?/))};return _.map(a,function(a){return _.each(["contentDurationMs","keyframeIntervalSeconds","width","height"],function(b){a[b]=parseFloat(a[b],10)}),a.duration=c(a.contentDurationMs/1e3),a.startTime=c(b),a.endTime=c(b+a.duration),b+=a.duration,a})},adjustForAds:function(a,b){return _.each(a,function(a){_.each(b,function(b){a.startTime<=b.startTime&&(b.startTime+=a.duration,b.endTime+=a.duration)})}),b}},Images={getTimeString:function(a){var b="";return _.times(4-a,function(){b+="0"}),b},getImage:function(a,b){b=Math.floor(b);var c=_.find(a,function(a){return b>=a.startTime&&b<a.endTime});if(c){c=_.clone(c);var d=Math.floor((b-c.startTime)/c.keyframeIntervalSeconds),e=Images.getTimeString(d.toString().length);c.src=c.src.replace("{0:0000}",e+d)}return c}},Config={whitelist:["feed","mediaGen","brightcove_mediagenRootURL","getImage","uri","geo","ref","type","group","device","network","chromeless","autoPlay","adFreeInterval","ccEnabled","useSegmentedScrubber","useNativeControls"],process:function(a){return a&&(a.adFreeInterval=a.timeSinceLastAd,_.isUndefined(a.adFreeInterval)&&(a.adFreeInterval=a.freewheelMinTimeBtwAds)),a},prune:function(a,b){return a?_.pick(a,this.whitelist.concat(b.whitelist||[])):void 0}},ConfigLoader=function(a){this.options=a||{},_.defaults(a,{shouldLoadMediaGen:!0,configParams:_.defaults(a.configParams||{},{returntype:"config",configtype:"vmap",uri:a.uri}),mediaGenParams:a.mediaGenParams||{}}),a.verboseErrorMessaging&&(this.getErrorMessage=_.identity),this.initialize.apply(this,arguments)},template=function(a,b){return a=a.replace(/\{{1,}/g,"{{").replace(/\}{1,}/g,"}}"),_.template(a,b,{interpolate:/\{\{(.+?)\}\}/g})},CONFIG_URL="http://media.mtvnservices.com/pmt/e1/access/index.html",Events=ConfigLoader.Events={READY:"ready",ERROR:"error"};ConfigLoader.DEFAULT_ERROR_MESSAGE="Sorry, this video is currently not available.",ConfigLoader.prototype={initialize:function(){_.bindAll(this,"onConfigLoaded","onMediaGenLoaded","onError","onLoadError","getImage"),EventEmitter.convert(this)},shouldLoadMediaGen:!0,getConfigUrl:function(){var a=template(this.options.configURL||CONFIG_URL,this.options,{});return Url.setParameters(a,this.options.configParams)},load:function(){this.request=new Request(this.getConfigUrl(),this.onConfigLoaded,this.onLoadError)},getImage:function(a){if(this.config){var b=this.config.mediaGen;if(b)return Images.getImage(b.image,a)}return void 0},getMediaGenUrl:function(){var a=this.options.mediaGenURL||this.config[this.options.mediaGenProperty||"mediaGen"];if(a){var b=_.clone(this.options.mediaGenParams);_.each(this.config.overrideParams,function(a,c){b["UMBEPARAM"+c]=a}),a=Url.setParameters(template(a,this.config),b)}else this.onError(this.getErrorMessage("no media gen specified."));return a},onConfigLoaded:function(a){if(a.config&&(a=a.config),a.error)return void this.onError(this.getErrorMessage(a.error));if(this.config=Config.process(a,this.options),this.config.getImage=this.getImage,this.options.shouldLoadMediaGen){var b=this.getMediaGenUrl();b?this.request=new Request(b,this.onMediaGenLoaded,this.onLoadError):this.onError(this.getErrorMessage("no media gen specified."))}else this.sendReady()},onMediaGenLoaded:function(a){var b;try{a=MediaGen.process(a)}catch(c){b=!0,this.onError(c.name===MediaGen.MEDIA_GEN_ERROR?c.message:this.getErrorMessage(c))}b||(this.config.mediaGen=a,this.sendReady())},sendReady:function(){this.config=Config.prune(this.config,this.options),this.emit(Events.READY,{type:Events.READY,data:this.config,target:this})},onLoadError:function(a){this.onError(this.getErrorMessage(a))},onError:function(a){this.emit(Events.ERROR,{type:Events.ERROR,data:a,target:this})},getErrorMessage:function(){return ConfigLoader.DEFAULT_ERROR_MESSAGE},destroy:function(){this.request&&this.request.abort()}},ConfigLoader.version="0.6.0",ConfigLoader.build="Fri May 09 2014 13:27:57";var Request=function(a,b,c){var d=this.request=new XMLHttpRequest;d.open("GET",a,!0),d.setRequestHeader("Accept","application/json"),d.onload=function(){if(d.status>=200&&d.status<400){var e,f;try{e=JSON.parse(d.responseText)}catch(g){f=g}e?b(e):c(f)}else c("Load Error, http status:"+d.status+" for "+a)},d.onerror=function(){c("Load Error, http status:"+d.status+" for "+a)},d.send()};Request.prototype={abort:function(){this.request.abort()}};var EventEmitter={convert:function(a,b){return b={},a.on=function(c,d){return(b[c]=b[c]||[]).push(d),a},a.once=function(b,c){function d(){c.apply(a.off(b,d),arguments)}return d.h=c,a.on(b,d)},a.off=function(c,d){for(var e=b[c],f=0;d&&e&&e[f];f++)e[f]!==d&&e[f].h!==d||e.splice(f--,1);return f||delete b[c],a},a.emit=function(c){for(var d=b[c],e=0;d&&d[e];)d[e++].apply(a,d.slice.call(arguments,1));return a},a}},MediaGen={MEDIA_GEN_ERROR:"mediaGenError",getItem:function(a){return a&&a.item?a.item:a.video.item},isVideoItem:function(a){return _.isObject(a.vmap)||_.isObject(a.rendition)||_.isArray(a.rendition)},process:function(a){_.isString(a)&&(a=JSON.parse(a));var b,c=this.getItem(a.package);return _.isArray(c)?(b=_.find(c,this.isVideoItem),b&&(b.overlay=_.find(c,function(a){return"overlay"===a.placement}))):this.isVideoItem(c)&&(b=c),b||_.some(c,function(a){if("text"===a.type)throw{name:MediaGen.MEDIA_GEN_ERROR,message:a.text}}),b.vmap&&(b.vmap=VMAPParser.process(b.vmap),b.image&&Segments.process(b.vmap.adBreaks,b.image)),b}},Segments={process:function(a,b){return Segments.adjustForAds(a,Segments.configureSegments(b))},configureSegments:function(a){var b=0,c=function(a){return Number(a.toString().match(/^\d+(?:\.\d{0,2})?/))};return _.map(a,function(a){return _.each(["contentDurationMs","keyframeIntervalSeconds","width","height"],function(b){a[b]=parseFloat(a[b],10)}),a.duration=c(a.contentDurationMs/1e3),a.startTime=c(b),a.endTime=c(b+a.duration),b+=a.duration,a})},adjustForAds:function(a,b){return _.each(a,function(a){_.each(b,function(b){a.startTime<=b.startTime&&(b.startTime+=a.duration,b.endTime+=a.duration)})}),b}},Images={getTimeString:function(a){var b="";return _.times(4-a,function(){b+="0"}),b},getImage:function(a,b){b=Math.floor(b);var c=_.find(a,function(a){return b>=a.startTime&&b<a.endTime});if(c){c=_.clone(c);var d=Math.floor((b-c.startTime)/c.keyframeIntervalSeconds),e=Images.getTimeString(d.toString().length);c.src=c.src.replace("{0:0000}",e+d)}return c}},Config={whitelist:["feed","mediaGen","brightcove_mediagenRootURL","getImage","uri","geo","ref","type","group","device","network","chromeless","autoPlay","adFreeInterval","ccEnabled","useSegmentedScrubber","useNativeControls"],process:function(a){return a&&(a.adFreeInterval=a.timeSinceLastAd,_.isUndefined(a.adFreeInterval)&&(a.adFreeInterval=a.freewheelMinTimeBtwAds)),a},prune:function(a,b){return a?_.pick(a,this.whitelist.concat(b.whitelist||[])):void 0}},ConfigLoader=function(a){this.options=a||{},_.defaults(a,{shouldLoadMediaGen:!0,configParams:_.defaults(a.configParams||{},{returntype:"config",configtype:"vmap",uri:a.uri}),mediaGenParams:a.mediaGenParams||{}}),a.verboseErrorMessaging&&(this.getErrorMessage=_.identity),this.initialize.apply(this,arguments)},template=function(a,b){return a=a.replace(/\{{1,}/g,"{{").replace(/\}{1,}/g,"}}"),_.template(a,b,{interpolate:/\{\{(.+?)\}\}/g})},CONFIG_URL="http://media.mtvnservices.com/pmt/e1/access/index.html",Events=ConfigLoader.Events={READY:"ready",ERROR:"error"};ConfigLoader.DEFAULT_ERROR_MESSAGE="Sorry, this video is currently not available.",ConfigLoader.prototype={initialize:function(){_.bindAll(this,"onConfigLoaded","onMediaGenLoaded","onError","onLoadError","getImage"),EventEmitter.convert(this)},shouldLoadMediaGen:!0,getConfigUrl:function(){var a=template(this.options.configURL||CONFIG_URL,this.options,{});return Url.setParameters(a,this.options.configParams)},load:function(){this.request=new Request(this.getConfigUrl(),this.onConfigLoaded,this.onLoadError)},getImage:function(a){if(this.config){var b=this.config.mediaGen;if(b)return Images.getImage(b.image,a)}return void 0},getMediaGenUrl:function(){var a=this.options.mediaGenURL||this.config[this.options.mediaGenProperty||"mediaGen"];if(a){var b=_.clone(this.options.mediaGenParams);_.each(this.config.overrideParams,function(a,c){b["UMBEPARAM"+c]=a}),a=Url.setParameters(template(a,this.config),b)}else this.onError(this.getErrorMessage("no media gen specified."));return a},onConfigLoaded:function(a){if(a.config&&(a=a.config),a.error)return void this.onError(this.getErrorMessage(a.error));if(this.config=Config.process(a,this.options),this.config.getImage=this.getImage,this.options.shouldLoadMediaGen){var b=this.getMediaGenUrl();b?this.request=new Request(b,this.onMediaGenLoaded,this.onLoadError):this.onError(this.getErrorMessage("no media gen specified."))}else this.sendReady()},onMediaGenLoaded:function(a){var b;try{a=MediaGen.process(a)}catch(c){b=!0,this.onError(c.name===MediaGen.MEDIA_GEN_ERROR?c.message:this.getErrorMessage(c))}b||(this.config.mediaGen=a,this.sendReady())},sendReady:function(){this.config=Config.prune(this.config,this.options),this.emit(Events.READY,{type:Events.READY,data:this.config,target:this})},onLoadError:function(a){this.onError(this.getErrorMessage(a))},onError:function(a){this.emit(Events.ERROR,{type:Events.ERROR,data:a,target:this})},getErrorMessage:function(){return ConfigLoader.DEFAULT_ERROR_MESSAGE},destroy:function(){this.request&&this.request.abort()}},ConfigLoader.version="0.6.0",ConfigLoader.build="Fri May 09 2014 13:27:57";var Request=function(a,b,c){var d=this.request=new XMLHttpRequest;d.open("GET",a,!0),d.setRequestHeader("Accept","application/json"),d.onload=function(){if(d.status>=200&&d.status<400){var e,f;try{e=JSON.parse(d.responseText)}catch(g){f=g}e?b(e):c(f)}else c("Load Error, http status:"+d.status+" for "+a)},d.onerror=function(){c("Load Error, http status:"+d.status+" for "+a)},d.send()};Request.prototype={abort:function(){this.request.abort()}};var EventEmitter={convert:function(a,b){return b={},a.on=function(c,d){return(b[c]=b[c]||[]).push(d),a},a.once=function(b,c){function d(){c.apply(a.off(b,d),arguments)}return d.h=c,a.on(b,d)},a.off=function(c,d){for(var e=b[c],f=0;d&&e&&e[f];f++)e[f]!==d&&e[f].h!==d||e.splice(f--,1);return f||delete b[c],a},a.emit=function(c){for(var d=b[c],e=0;d&&d[e];)d[e++].apply(a,d.slice.call(arguments,1));return a},a}},MediaGen={MEDIA_GEN_ERROR:"mediaGenError",getItem:function(a){return a&&a.item?a.item:a.video.item},isVideoItem:function(a){return _.isObject(a.vmap)||_.isObject(a.rendition)||_.isArray(a.rendition)},process:function(a){_.isString(a)&&(a=JSON.parse(a));var b,c=this.getItem(a.package);return _.isArray(c)?(b=_.find(c,this.isVideoItem),b&&(b.overlay=_.find(c,function(a){return"overlay"===a.placement}))):this.isVideoItem(c)&&(b=c),b||_.some(c,function(a){if("text"===a.type)throw{name:MediaGen.MEDIA_GEN_ERROR,message:a.text}}),b.vmap&&(b.vmap=VMAPParser.process(b.vmap),b.image&&Segments.process(b.vmap.adBreaks,b.image)),b}},Segments={process:function(a,b){return Segments.adjustForAds(a,Segments.configureSegments(b))},configureSegments:function(a){var b=0,c=function(a){return Number(a.toString().match(/^\d+(?:\.\d{0,2})?/))};return _.map(a,function(a){return _.each(["contentDurationMs","keyframeIntervalSeconds","width","height"],function(b){a[b]=parseFloat(a[b],10)}),a.duration=c(a.contentDurationMs/1e3),a.startTime=c(b),a.endTime=c(b+a.duration),b+=a.duration,a})},adjustForAds:function(a,b){return _.each(a,function(a){_.each(b,function(b){a.startTime<=b.startTime&&(b.startTime+=a.duration,b.endTime+=a.duration)})}),b}},Images={getTimeString:function(a){var b="";return _.times(4-a,function(){b+="0"}),b},getImage:function(a,b){b=Math.floor(b);var c=_.find(a,function(a){return b>=a.startTime&&b<a.endTime});if(c){c=_.clone(c);var d=Math.floor((b-c.startTime)/c.keyframeIntervalSeconds),e=Images.getTimeString(d.toString().length);c.src=c.src.replace("{0:0000}",e+d)}return c}},Config={whitelist:["feed","mediaGen","brightcove_mediagenRootURL","getImage","uri","geo","ref","type","group","device","network","chromeless","autoPlay","adFreeInterval","ccEnabled","useSegmentedScrubber","useNativeControls"],process:function(a){return a&&(a.adFreeInterval=a.timeSinceLastAd,_.isUndefined(a.adFreeInterval)&&(a.adFreeInterval=a.freewheelMinTimeBtwAds)),a},prune:function(a,b){return a?_.pick(a,this.whitelist.concat(b.whitelist||[])):void 0}},ConfigLoader=function(a){this.options=a||{},_.defaults(a,{shouldLoadMediaGen:!0,configParams:_.defaults(a.configParams||{},{returntype:"config",configtype:"vmap",uri:a.uri}),mediaGenParams:a.mediaGenParams||{}}),a.verboseErrorMessaging&&(this.getErrorMessage=_.identity),this.initialize.apply(this,arguments)},template=function(a,b){return a=a.replace(/\{{1,}/g,"{{").replace(/\}{1,}/g,"}}"),_.template(a,b,{interpolate:/\{\{(.+?)\}\}/g})},CONFIG_URL="http://media.mtvnservices.com/pmt/e1/access/index.html",Events=ConfigLoader.Events={READY:"ready",ERROR:"error"};ConfigLoader.DEFAULT_ERROR_MESSAGE="Sorry, this video is currently not available.",ConfigLoader.prototype={initialize:function(){_.bindAll(this,"onConfigLoaded","onMediaGenLoaded","onError","onLoadError","getImage"),EventEmitter.convert(this)},shouldLoadMediaGen:!0,getConfigUrl:function(){var a=template(this.options.configURL||CONFIG_URL,this.options,{});return Url.setParameters(a,this.options.configParams)},load:function(){this.request=new Request(this.getConfigUrl(),this.onConfigLoaded,this.onLoadError)},getImage:function(a){if(this.config){var b=this.config.mediaGen;if(b)return Images.getImage(b.image,a)}return void 0},getMediaGenUrl:function(){var a=this.options.mediaGenURL||this.config[this.options.mediaGenProperty||"mediaGen"];if(a){var b=_.clone(this.options.mediaGenParams);_.each(this.config.overrideParams,function(a,c){b["UMBEPARAM"+c]=a}),a=Url.setParameters(template(a,this.config),b)}else this.onError(this.getErrorMessage("no media gen specified."));return a},onConfigLoaded:function(a){if(a.config&&(a=a.config),a.error)return void this.onError(this.getErrorMessage(a.error));if(this.config=Config.process(a,this.options),this.config.getImage=this.getImage,this.options.shouldLoadMediaGen){var b=this.getMediaGenUrl();b?this.request=new Request(b,this.onMediaGenLoaded,this.onLoadError):this.onError(this.getErrorMessage("no media gen specified."))}else this.sendReady()},onMediaGenLoaded:function(a){var b;try{a=MediaGen.process(a)}catch(c){b=!0,this.onError(c.name===MediaGen.MEDIA_GEN_ERROR?c.message:this.getErrorMessage(c))}b||(this.config.mediaGen=a,this.sendReady())},sendReady:function(){this.config=Config.prune(this.config,this.options),this.emit(Events.READY,{type:Events.READY,data:this.config,target:this})},onLoadError:function(a){this.onError(this.getErrorMessage(a))},onError:function(a){this.emit(Events.ERROR,{type:Events.ERROR,data:a,target:this})},getErrorMessage:function(){return ConfigLoader.DEFAULT_ERROR_MESSAGE},destroy:function(){this.request&&this.request.abort()}},ConfigLoader.version="0.6.0",ConfigLoader.build="Fri May 09 2014 13:25:41";var Request=function(a,b,c){var d=this.request=new XMLHttpRequest;d.open("GET",a,!0),d.setRequestHeader("Accept","application/json"),d.onload=function(){if(d.status>=200&&d.status<400){var e,f;try{e=JSON.parse(d.responseText)}catch(g){f=g}e?b(e):c(f)}else c("Load Error, http status:"+d.status+" for "+a)},d.onerror=function(){c("Load Error, http status:"+d.status+" for "+a)},d.send()};Request.prototype={abort:function(){this.request.abort()}};var EventEmitter={convert:function(a,b){return b={},a.on=function(c,d){return(b[c]=b[c]||[]).push(d),a},a.once=function(b,c){function d(){c.apply(a.off(b,d),arguments)}return d.h=c,a.on(b,d)},a.off=function(c,d){for(var e=b[c],f=0;d&&e&&e[f];f++)e[f]!==d&&e[f].h!==d||e.splice(f--,1);return f||delete b[c],a},a.emit=function(c){for(var d=b[c],e=0;d&&d[e];)d[e++].apply(a,d.slice.call(arguments,1));return a},a}},MediaGen={MEDIA_GEN_ERROR:"mediaGenError",getItem:function(a){return a&&a.item?a.item:a.video.item},isVideoItem:function(a){return _.isObject(a.vmap)||_.isObject(a.rendition)||_.isArray(a.rendition)},process:function(a){_.isString(a)&&(a=JSON.parse(a));var b,c=this.getItem(a.package);return _.isArray(c)?(b=_.find(c,this.isVideoItem),b&&(b.overlay=_.find(c,function(a){return"overlay"===a.placement}))):this.isVideoItem(c)&&(b=c),b||_.some(c,function(a){if("text"===a.type)throw{name:MediaGen.MEDIA_GEN_ERROR,message:a.text}}),b.vmap&&(b.vmap=VMAPParser.process(b.vmap),b.image&&Segments.process(b.vmap.adBreaks,b.image)),b}},Segments={process:function(a,b){return Segments.adjustForAds(a,Segments.configureSegments(b))},configureSegments:function(a){var b=0,c=function(a){return Number(a.toString().match(/^\d+(?:\.\d{0,2})?/))};return _.map(a,function(a){return _.each(["contentDurationMs","keyframeIntervalSeconds","width","height"],function(b){a[b]=parseFloat(a[b],10)}),a.duration=c(a.contentDurationMs/1e3),a.startTime=c(b),a.endTime=c(b+a.duration),b+=a.duration,a})},adjustForAds:function(a,b){return _.each(a,function(a){_.each(b,function(b){a.startTime<=b.startTime&&(b.startTime+=a.duration,b.endTime+=a.duration)})}),b}},Images={getTimeString:function(a){var b="";return _.times(4-a,function(){b+="0"}),b},getImage:function(a,b){b=Math.floor(b);var c=_.find(a,function(a){return b>=a.startTime&&b<a.endTime});if(c){c=_.clone(c);var d=Math.floor((b-c.startTime)/c.keyframeIntervalSeconds),e=Images.getTimeString(d.toString().length);c.src=c.src.replace("{0:0000}",e+d)}return c}},Config={whitelist:["feed","mediaGen","brightcove_mediagenRootURL","getImage","uri","geo","ref","type","group","device","network","chromeless","autoPlay","adFreeInterval","ccEnabled","useSegmentedScrubber","useNativeControls"],process:function(a){return a&&(a.adFreeInterval=a.timeSinceLastAd,_.isUndefined(a.adFreeInterval)&&(a.adFreeInterval=a.freewheelMinTimeBtwAds)),a},prune:function(a,b){return a?_.pick(a,this.whitelist.concat(b.whitelist||[])):void 0}},ConfigLoader=function(a){this.options=a||{},_.defaults(a,{shouldLoadMediaGen:!0,configParams:_.defaults(a.configParams||{},{returntype:"config",configtype:"vmap",uri:a.uri}),mediaGenParams:a.mediaGenParams||{}}),a.verboseErrorMessaging&&(this.getErrorMessage=_.identity),this.initialize.apply(this,arguments)},template=function(a,b){return a=a.replace(/\{{1,}/g,"{{").replace(/\}{1,}/g,"}}"),_.template(a,b,{interpolate:/\{\{(.+?)\}\}/g})},CONFIG_URL="http://media.mtvnservices.com/pmt/e1/access/index.html",Events=ConfigLoader.Events={READY:"ready",ERROR:"error"};ConfigLoader.DEFAULT_ERROR_MESSAGE="Sorry, this video is currently not available.",ConfigLoader.prototype={initialize:function(){_.bindAll(this,"onConfigLoaded","onMediaGenLoaded","onError","onLoadError","getImage"),EventEmitter.convert(this)},shouldLoadMediaGen:!0,getConfigUrl:function(){var a=template(this.options.configURL||CONFIG_URL,this.options,{});return Url.setParameters(a,this.options.configParams)},load:function(){this.request=new Request(this.getConfigUrl(),this.onConfigLoaded,this.onLoadError)},getImage:function(a){if(this.config){var b=this.config.mediaGen;if(b)return Images.getImage(b.image,a)}return void 0},getMediaGenUrl:function(){var a=this.options.mediaGenURL||this.config[this.options.mediaGenProperty||"mediaGen"];if(a){var b=_.clone(this.options.mediaGenParams);_.each(this.config.overrideParams,function(a,c){b["UMBEPARAM"+c]=a}),a=Url.setParameters(template(a,this.config),b)}else this.onError(this.getErrorMessage("no media gen specified."));return a},onConfigLoaded:function(a){if(a.config&&(a=a.config),a.error)return void this.onError(this.getErrorMessage(a.error));if(this.config=Config.process(a,this.options),this.config.getImage=this.getImage,this.options.shouldLoadMediaGen){var b=this.getMediaGenUrl();b?this.request=new Request(b,this.onMediaGenLoaded,this.onLoadError):this.onError(this.getErrorMessage("no media gen specified."))}else this.sendReady()},onMediaGenLoaded:function(a){var b;try{a=MediaGen.process(a)}catch(c){b=!0,this.onError(c.name===MediaGen.MEDIA_GEN_ERROR?c.message:this.getErrorMessage(c))}b||(this.config.mediaGen=a,this.sendReady())},sendReady:function(){this.config=Config.prune(this.config,this.options),this.emit(Events.READY,{type:Events.READY,data:this.config,target:this})},onLoadError:function(a){this.onError(this.getErrorMessage(a))},onError:function(a){this.emit(Events.ERROR,{type:Events.ERROR,data:a,target:this})},getErrorMessage:function(){return ConfigLoader.DEFAULT_ERROR_MESSAGE},destroy:function(){this.request&&this.request.abort()}},ConfigLoader.version="0.6.0",ConfigLoader.build="Fri May 09 2014 13:19:50";var Request=function(a,b,c){var d=this.request=new XMLHttpRequest;d.open("GET",a,!0),d.setRequestHeader("Accept","application/json"),d.onload=function(){if(d.status>=200&&d.status<400){var e,f;try{e=JSON.parse(d.responseText)}catch(g){f=g}e?b(e):c(f)}else c("Load Error, http status:"+d.status+" for "+a)},d.onerror=function(){c("Load Error, http status:"+d.status+" for "+a)},d.send()};Request.prototype={abort:function(){this.request.abort()}};var EventEmitter={convert:function(a,b){return b={},a.on=function(c,d){return(b[c]=b[c]||[]).push(d),a},a.once=function(b,c){function d(){c.apply(a.off(b,d),arguments)}return d.h=c,a.on(b,d)},a.off=function(c,d){for(var e=b[c],f=0;d&&e&&e[f];f++)e[f]!==d&&e[f].h!==d||e.splice(f--,1);return f||delete b[c],a},a.emit=function(c){for(var d=b[c],e=0;d&&d[e];)d[e++].apply(a,d.slice.call(arguments,1));return a},a}},MediaGen={MEDIA_GEN_ERROR:"mediaGenError",getItem:function(a){return a&&a.item?a.item:a.video.item},isVideoItem:function(a){return _.isObject(a.vmap)||_.isObject(a.rendition)||_.isArray(a.rendition)},process:function(a){_.isString(a)&&(a=JSON.parse(a));var b,c=this.getItem(a.package);return _.isArray(c)?(b=_.find(c,this.isVideoItem),b&&(b.overlay=_.find(c,function(a){return"overlay"===a.placement}))):this.isVideoItem(c)&&(b=c),b||_.some(c,function(a){if("text"===a.type)throw{name:MediaGen.MEDIA_GEN_ERROR,message:a.text}}),b.vmap&&(b.vmap=VMAPParser.process(b.vmap)),b}},Segments={get:function(a,b){return Segments.adjustForAds(a,Segments.configureSegments(b))},configureSegments:function(a){var b=0,c=function(a){return Number(a.toString().match(/^\d+(?:\.\d{0,2})?/))};return _.map(a,function(a){return _.each(["contentDurationMs","keyframeIntervalSeconds"],function(b){a[b]=parseFloat(a[b],10)}),a.duration=c(a.contentDurationMs/1e3),a.startTime=c(b),a.endTime=c(b+a.duration),b+=a.duration,a})},adjustForAds:function(a,b){return _.each(a,function(a){_.each(b,function(b){a.startTime<=b.startTime&&(b.startTime+=a.duration,b.endTime+=a.duration)})}),b}},Images=function(a,b){this.segments=Segments.get(a,b)};Images.prototype={getImage:function(a){a=Math.floor(a);var b=_.find(this.segments,function(b){return a>=b.startTime&&a<b.endTime});if(b){b=_.clone(b);var c=Math.floor((a-b.startTime)/b.keyframeIntervalSeconds),d=new Array(5-c.toString().length).join("0");b.src=b.src.replace("{0:0000}",d+c)}return b}};var Config={whitelist:["feed","mediaGen","brightcove_mediagenRootURL","getImage","uri","geo","ref","type","group","device","network","chromeless","autoPlay","adFreeInterval","ccEnabled","useSegmentedScrubber","useNativeControls"],process:function(a){return a&&(a.adFreeInterval=a.timeSinceLastAd,_.isUndefined(a.adFreeInterval)&&(a.adFreeInterval=a.freewheelMinTimeBtwAds)),a},prune:function(a,b){return a?_.pick(a,this.whitelist.concat(b.whitelist||[])):void 0}},ConfigLoader=function(a){this.options=a||{},_.defaults(a,{shouldLoadMediaGen:!0,configParams:_.defaults(a.configParams||{},{returntype:"config",configtype:"vmap",uri:a.uri}),mediaGenParams:a.mediaGenParams||{}}),a.verboseErrorMessaging&&(this.getErrorMessage=_.identity),this.initialize.apply(this,arguments)},template=function(a,b){return a=a.replace(/\{{1,}/g,"{{").replace(/\}{1,}/g,"}}"),_.template(a,b,{interpolate:/\{\{(.+?)\}\}/g})},CONFIG_URL="http://media.mtvnservices.com/pmt/e1/access/index.html",Events=ConfigLoader.Events={READY:"ready",ERROR:"error"};ConfigLoader.DEFAULT_ERROR_MESSAGE="Sorry, this video is currently not available.",ConfigLoader.prototype={initialize:function(){_.bindAll(this,"onConfigLoaded","onMediaGenLoaded","onError","onLoadError","getImage"),EventEmitter.convert(this)},shouldLoadMediaGen:!0,getConfigUrl:function(){var a=template(this.options.configURL||CONFIG_URL,this.options,{});return Url.setParameters(a,this.options.configParams)},load:function(){this.request=new Request(this.getConfigUrl(),this.onConfigLoaded,this.onLoadError)},getImage:function(a){if(!this.images&&this.config){var b=this.config.mediaGen;b&&(this.images=new Images(b.vmap.adBreaks,b.image))}return this.images?this.images.getImage(a):void 0},getMediaGenUrl:function(){var a=this.options.mediaGenURL||this.config[this.options.mediaGenProperty||"mediaGen"];if(a){var b=_.clone(this.options.mediaGenParams);_.each(this.config.overrideParams,function(a,c){b["UMBEPARAM"+c]=a}),a=Url.setParameters(template(a,this.config),b)}else this.onError(this.getErrorMessage("no media gen specified."));return a},onConfigLoaded:function(a){if(a.config&&(a=a.config),a.error)return void this.onError(this.getErrorMessage(a.error));if(this.config=Config.process(a,this.options),this.config.getImage=this.getImage,this.options.shouldLoadMediaGen){var b=this.getMediaGenUrl();b?this.request=new Request(b,this.onMediaGenLoaded,this.onLoadError):this.onError(this.getErrorMessage("no media gen specified."))}else this.sendReady()},onMediaGenLoaded:function(a){var b;try{a=MediaGen.process(a)}catch(c){b=!0,this.onError(c.name===MediaGen.MEDIA_GEN_ERROR?c.message:this.getErrorMessage(c))}b||(this.config.mediaGen=a,this.sendReady())},sendReady:function(){this.config=Config.prune(this.config,this.options),this.emit(Events.READY,{type:Events.READY,data:this.config,target:this})},onLoadError:function(a){this.onError(this.getErrorMessage(a))},onError:function(a){this.emit(Events.ERROR,{type:Events.ERROR,data:a,target:this})},getErrorMessage:function(){return ConfigLoader.DEFAULT_ERROR_MESSAGE},destroy:function(){this.request&&this.request.abort()}},ConfigLoader.version="0.6.0",ConfigLoader.build="Thu May 08 2014 18:21:18";var Request=function(a,b,c){var d=this.request=new XMLHttpRequest;d.open("GET",a,!0),d.setRequestHeader("Accept","application/json"),d.onload=function(){if(d.status>=200&&d.status<400){var e,f;try{e=JSON.parse(d.responseText)}catch(g){f=g}e?b(e):c(f)}else c("Load Error, http status:"+d.status+" for "+a)},d.onerror=function(){c("Load Error, http status:"+d.status+" for "+a)},d.send()};Request.prototype={abort:function(){this.request.abort()}};var EventEmitter={convert:function(a,b){return b={},a.on=function(c,d){return(b[c]=b[c]||[]).push(d),a},a.once=function(b,c){function d(){c.apply(a.off(b,d),arguments)}return d.h=c,a.on(b,d)},a.off=function(c,d){for(var e=b[c],f=0;d&&e&&e[f];f++)e[f]!==d&&e[f].h!==d||e.splice(f--,1);return f||delete b[c],a},a.emit=function(c){for(var d=b[c],e=0;d&&d[e];)d[e++].apply(a,d.slice.call(arguments,1));return a},a}},MediaGen={MEDIA_GEN_ERROR:"mediaGenError",getItem:function(a){return a&&a.item?a.item:a.video.item},isVideoItem:function(a){return _.isObject(a.vmap)||_.isObject(a.rendition)||_.isArray(a.rendition)},process:function(a){_.isString(a)&&(a=JSON.parse(a));var b,c=this.getItem(a.package);return _.isArray(c)?(b=_.find(c,this.isVideoItem),b&&(b.overlay=_.find(c,function(a){return"overlay"===a.placement}))):this.isVideoItem(c)&&(b=c),b||_.some(c,function(a){if("text"===a.type)throw{name:MediaGen.MEDIA_GEN_ERROR,message:a.text}}),b.vmap&&(b.vmap=VMAPParser.process(b.vmap)),b}},Segments={get:function(a,b){return Segments.adjustForAds(a,Segments.configureSegments(b))},configureSegments:function(a){var b=0,c=function(a){return Number(a.toString().match(/^\d+(?:\.\d{0,2})?/))};return _.map(a,function(a){return _.each(["contentDurationMs","keyframeIntervalSeconds"],function(b){a[b]=parseFloat(a[b],10)}),a.duration=c(a.contentDurationMs/1e3),a.startTime=c(b),a.endTime=c(b+a.duration),b+=a.duration,a})},adjustForAds:function(a,b){return _.each(a,function(a){_.each(b,function(b){a.startTime<=b.startTime&&(b.startTime+=a.duration,b.endTime+=a.duration)})}),b}},Images=function(a,b){this.segments=Segments.get(a,b)};Images.prototype={getImage:function(a){a=Math.floor(a);var b=_.find(this.segments,function(b){return a>=b.startTime&&a<b.endTime});if(b){b=_.clone(b);var c=Math.floor((a-b.startTime)/b.keyframeIntervalSeconds),d=new Array(5-c.toString().length).join("0");b.src=b.src.replace("{0:0000}",d+c)}return b}};var Config={whitelist:["feed","mediaGen","brightcove_mediagenRootURL","getImage","uri","geo","ref","type","group","device","network","chromeless","autoPlay","adFreeInterval","ccEnabled","useSegmentedScrubber","useNativeControls"],process:function(a){return a&&(a.adFreeInterval=a.timeSinceLastAd,_.isUndefined(a.adFreeInterval)&&(a.adFreeInterval=a.freewheelMinTimeBtwAds)),a},prune:function(a,b){return a?_.pick(a,this.whitelist.concat(b.whitelist||[])):void 0}},ConfigLoader=function(a){this.options=a||{},_.defaults(a,{shouldLoadMediaGen:!0,configParams:_.defaults(a.configParams||{},{returntype:"config",configtype:"vmap",uri:a.uri}),mediaGenParams:a.mediaGenParams||{}}),a.verboseErrorMessaging&&(this.getErrorMessage=_.identity),this.initialize.apply(this,arguments)},template=function(a,b){return a=a.replace(/\{{1,}/g,"{{").replace(/\}{1,}/g,"}}"),_.template(a,b,{interpolate:/\{\{(.+?)\}\}/g})},CONFIG_URL="http://media.mtvnservices.com/pmt/e1/access/index.html",Events=ConfigLoader.Events={READY:"ready",ERROR:"error"};ConfigLoader.DEFAULT_ERROR_MESSAGE="Sorry, this video is currently not available.",ConfigLoader.prototype={initialize:function(){_.bindAll(this,"onConfigLoaded","onMediaGenLoaded","onError","onLoadError","getImage"),EventEmitter.convert(this)},shouldLoadMediaGen:!0,getConfigUrl:function(){var a=template(this.options.configURL||CONFIG_URL,this.options,{});return Url.setParameters(a,this.options.configParams)},load:function(){this.request=new Request(this.getConfigUrl(),this.onConfigLoaded,this.onLoadError)},getImage:function(a){if(!this.images&&this.config){var b=this.config.mediaGen;b&&(this.images=new Images(b.vmap.adBreaks,b.image))}return this.images?this.images.getImage(a):void 0},getMediaGenUrl:function(){var a=this.options.mediaGenURL||this.config[this.options.mediaGenProperty||"mediaGen"];
if(a){var b=_.clone(this.options.mediaGenParams);_.each(this.config.overrideParams,function(a,c){b["UMBEPARAM"+c]=a}),a=Url.setParameters(template(a,this.config),b)}else this.onError(this.getErrorMessage("no media gen specified."));return a},onConfigLoaded:function(a){if(a.config&&(a=a.config),a.error)return void this.onError(this.getErrorMessage(a.error));if(this.config=Config.process(a,this.options),this.config.getImage=this.getImage,this.options.shouldLoadMediaGen){var b=this.getMediaGenUrl();b?this.request=new Request(b,this.onMediaGenLoaded,this.onLoadError):this.onError(this.getErrorMessage("no media gen specified."))}else this.sendReady()},onMediaGenLoaded:function(a){var b;try{a=MediaGen.process(a)}catch(c){b=!0,this.onError(c.name===MediaGen.MEDIA_GEN_ERROR?c.message:this.getErrorMessage(c))}b||(this.config.mediaGen=a,this.sendReady())},sendReady:function(){this.config=Config.prune(this.config,this.options),this.emit(Events.READY,{type:Events.READY,data:this.config,target:this})},onLoadError:function(a){this.onError(this.getErrorMessage(a))},onError:function(a){this.emit(Events.ERROR,{type:Events.ERROR,data:a,target:this})},getErrorMessage:function(){return ConfigLoader.DEFAULT_ERROR_MESSAGE},destroy:function(){this.request&&this.request.abort()}},ConfigLoader.version="0.6.0",ConfigLoader.build="Thu May 08 2014 18:20:15";var Request=function(a,b,c){var d=this.request=new XMLHttpRequest;d.open("GET",a,!0),d.setRequestHeader("Accept","application/json"),d.onload=function(){if(d.status>=200&&d.status<400){var e,f;try{e=JSON.parse(d.responseText)}catch(g){f=g}e?b(e):c(f)}else c("Load Error, http status:"+d.status+" for "+a)},d.onerror=function(){c("Load Error, http status:"+d.status+" for "+a)},d.send()};Request.prototype={abort:function(){this.request.abort()}};var EventEmitter={convert:function(a,b){return b={},a.on=function(c,d){return(b[c]=b[c]||[]).push(d),a},a.once=function(b,c){function d(){c.apply(a.off(b,d),arguments)}return d.h=c,a.on(b,d)},a.off=function(c,d){for(var e=b[c],f=0;d&&e&&e[f];f++)e[f]!==d&&e[f].h!==d||e.splice(f--,1);return f||delete b[c],a},a.emit=function(c){for(var d=b[c],e=0;d&&d[e];)d[e++].apply(a,d.slice.call(arguments,1));return a},a}},MediaGen={MEDIA_GEN_ERROR:"mediaGenError",getItem:function(a){return a&&a.item?a.item:a.video.item},isVideoItem:function(a){return _.isObject(a.vmap)||_.isObject(a.rendition)||_.isArray(a.rendition)},process:function(a){_.isString(a)&&(a=JSON.parse(a));var b,c=this.getItem(a.package);return _.isArray(c)?(b=_.find(c,this.isVideoItem),b&&(b.overlay=_.find(c,function(a){return"overlay"===a.placement}))):this.isVideoItem(c)&&(b=c),b||_.some(c,function(a){if("text"===a.type)throw{name:MediaGen.MEDIA_GEN_ERROR,message:a.text}}),b.vmap&&(b.vmap=VMAPParser.process(b.vmap)),b}},Segments={get:function(a,b){return Segments.adjustForAds(a,Segments.configureSegments(b))},configureSegments:function(a){var b=0,c=function(a){return Number(a.toString().match(/^\d+(?:\.\d{0,2})?/))};return _.map(a,function(a){return _.each(["contentDurationMs","keyframeIntervalSeconds"],function(b){a[b]=parseFloat(a[b],10)}),a.duration=c(a.contentDurationMs/1e3),a.startTime=c(b),a.endTime=c(b+a.duration),b+=a.duration,a})},adjustForAds:function(a,b){return _.each(a,function(a){_.each(b,function(b){a.startTime<=b.startTime&&(b.startTime+=a.duration,b.endTime+=a.duration)})}),b}},Images=function(a,b){this.segments=Segments.get(a,b)};Images.prototype={getImage:function(a){a=Math.floor(a);var b=_.find(this.segments,function(b){return a>=b.startTime&&a<b.endTime});if(b){b=_.clone(b);var c=Math.floor((a-b.startTime)/b.keyframeIntervalSeconds),d=new Array(5-c.toString().length).join("0");b.src=b.src.replace("{0:0000}",d+c)}return b}};var Config={whitelist:["feed","mediaGen","brightcove_mediagenRootURL","getImage","uri","geo","ref","type","group","device","network","chromeless","autoPlay","adFreeInterval","ccEnabled","useSegmentedScrubber","useNativeControls"],process:function(a){return a&&(a.adFreeInterval=a.timeSinceLastAd,_.isUndefined(a.adFreeInterval)&&(a.adFreeInterval=a.freewheelMinTimeBtwAds)),a},prune:function(a,b){return a?_.pick(a,this.whitelist.concat(b.whitelist||[])):void 0}},ConfigLoader=function(a){this.options=a||{},_.defaults(a,{shouldLoadMediaGen:!0,configParams:_.defaults(a.configParams||{},{returntype:"config",configtype:"vmap",uri:a.uri}),mediaGenParams:a.mediaGenParams||{}}),a.verboseErrorMessaging&&(this.getErrorMessage=_.identity),this.initialize.apply(this,arguments)},template=function(a,b){return a=a.replace(/\{{1,}/g,"{{").replace(/\}{1,}/g,"}}"),_.template(a,b,{interpolate:/\{\{(.+?)\}\}/g})},CONFIG_URL="http://media.mtvnservices.com/pmt/e1/access/index.html",Events=ConfigLoader.Events={READY:"ready",ERROR:"error"};ConfigLoader.DEFAULT_ERROR_MESSAGE="Sorry, this video is currently not available.",ConfigLoader.prototype={initialize:function(){_.bindAll(this,"onConfigLoaded","onMediaGenLoaded","onError","onLoadError","getImage"),EventEmitter.convert(this)},shouldLoadMediaGen:!0,getConfigUrl:function(){var a=template(this.options.configURL||CONFIG_URL,this.options,{});return Url.setParameters(a,this.options.configParams)},load:function(){this.request=new Request(this.getConfigUrl(),this.onConfigLoaded,this.onLoadError)},getImage:function(a){if(!this.images&&this.config){var b=this.config.mediaGen;b&&(this.images=new Images(b.vmap.adBreaks,b.image))}return this.images?this.images.getImage(a):void 0},getMediaGenUrl:function(){var a=this.options.mediaGenURL||this.config[this.options.mediaGenProperty||"mediaGen"];if(a){var b=_.clone(this.options.mediaGenParams);_.each(this.config.overrideParams,function(a,c){b["UMBEPARAM"+c]=a}),a=Url.setParameters(template(a,this.config),b)}else this.onError(this.getErrorMessage("no media gen specified."));return a},onConfigLoaded:function(a){if(a.config&&(a=a.config),a.error)return void this.onError(this.getErrorMessage(a.error));if(this.config=Config.process(a,this.options),this.config.getImage=this.getImage,this.options.shouldLoadMediaGen){var b=this.getMediaGenUrl();b?this.request=new Request(b,this.onMediaGenLoaded,this.onLoadError):this.onError(this.getErrorMessage("no media gen specified."))}else this.sendReady()},onMediaGenLoaded:function(a){var b;try{a=MediaGen.process(a)}catch(c){b=!0,this.onError(c.name===MediaGen.MEDIA_GEN_ERROR?c.message:this.getErrorMessage(c))}b||(this.config.mediaGen=a,this.sendReady())},sendReady:function(){this.config=Config.prune(this.config,this.options),this.emit(Events.READY,{type:Events.READY,data:this.config,target:this})},onLoadError:function(a){this.onError(this.getErrorMessage(a))},onError:function(a){this.emit(Events.ERROR,{type:Events.ERROR,data:a,target:this})},getErrorMessage:function(){return ConfigLoader.DEFAULT_ERROR_MESSAGE},destroy:function(){this.request&&this.request.abort()}},ConfigLoader.version="0.6.0",ConfigLoader.build="Thu May 08 2014 18:12:41";var Request=function(a,b,c){var d=this.request=new XMLHttpRequest;d.open("GET",a,!0),d.setRequestHeader("Accept","application/json"),d.onload=function(){if(d.status>=200&&d.status<400){var a,e;try{a=JSON.parse(d.responseText)}catch(f){e=f}a?b(a):c(e)}else c(d.status)},d.onerror=function(){c(d.status)},d.send()};Request.prototype={abort:function(){this.request.abort()}};var EventEmitter={convert:function(a,b){return b={},a.on=function(c,d){return(b[c]=b[c]||[]).push(d),a},a.once=function(b,c){function d(){c.apply(a.off(b,d),arguments)}return d.h=c,a.on(b,d)},a.off=function(c,d){for(var e=b[c],f=0;d&&e&&e[f];f++)e[f]!==d&&e[f].h!==d||e.splice(f--,1);return f||delete b[c],a},a.emit=function(c){for(var d=b[c],e=0;d&&d[e];)d[e++].apply(a,d.slice.call(arguments,1));return a},a}},MediaGen={MEDIA_GEN_ERROR:"mediaGenError",getItem:function(a){return a&&a.item?a.item:a.video.item},isVideoItem:function(a){return _.isObject(a.vmap)||_.isObject(a.rendition)||_.isArray(a.rendition)},process:function(a){_.isString(a)&&(a=JSON.parse(a));var b,c=this.getItem(a.package);return _.isArray(c)?(b=_.find(c,this.isVideoItem),b&&(b.overlay=_.find(c,function(a){return"overlay"===a.placement}))):this.isVideoItem(c)&&(b=c),b||_.some(c,function(a){if("text"===a.type)throw{name:MediaGen.MEDIA_GEN_ERROR,message:a.text}}),b.vmap&&(b.vmap=VMAPParser.process(b.vmap)),b}},Segments={get:function(a,b){return Segments.adjustForAds(a,Segments.configureSegments(b))},configureSegments:function(a){var b=0,c=function(a){return Number(a.toString().match(/^\d+(?:\.\d{0,2})?/))};return _.map(a,function(a){return _.each(["contentDurationMs","keyframeIntervalSeconds"],function(b){a[b]=parseFloat(a[b],10)}),a.duration=c(a.contentDurationMs/1e3),a.startTime=c(b),a.endTime=c(b+a.duration),b+=a.duration,a})},adjustForAds:function(a,b){return _.each(a,function(a){_.each(b,function(b){a.startTime<=b.startTime&&(b.startTime+=a.duration,b.endTime+=a.duration)})}),b}},Images=function(a,b){this.segments=Segments.get(a,b)};Images.prototype={getImage:function(a){a=Math.floor(a);var b=_.find(this.segments,function(b){return a>=b.startTime&&a<b.endTime});if(b){b=_.clone(b);var c=Math.floor((a-b.startTime)/b.keyframeIntervalSeconds),d=new Array(5-c.toString().length).join("0");b.src=b.src.replace("{0:0000}",d+c)}return b}};var Config={whitelist:["feed","mediaGen","brightcove_mediagenRootURL","getImage","uri","geo","ref","type","group","device","network","chromeless","autoPlay","adFreeInterval","ccEnabled","useSegmentedScrubber","useNativeControls"],process:function(a){return a&&(a.adFreeInterval=a.timeSinceLastAd,_.isUndefined(a.adFreeInterval)&&(a.adFreeInterval=a.freewheelMinTimeBtwAds)),a},prune:function(a,b){return a?_.pick(a,this.whitelist.concat(b.whitelist||[])):void 0}},ConfigLoader=function(a){this.options=a||{},_.defaults(a,{shouldLoadMediaGen:!0,configParams:_.defaults(a.configParams||{},{returntype:"config",configtype:"vmap",uri:a.uri}),mediaGenParams:a.mediaGenParams||{}}),a.verboseErrorMessaging&&(this.getErrorMessage=_.identity),this.initialize.apply(this,arguments)},template=function(a,b){return a=a.replace(/\{{1,}/g,"{{").replace(/\}{1,}/g,"}}"),_.template(a,b,{interpolate:/\{\{(.+?)\}\}/g})},CONFIG_URL="http://media.mtvnservices.com/pmt/e1/access/index.html",Events=ConfigLoader.Events={READY:"ready",ERROR:"error"};ConfigLoader.DEFAULT_ERROR_MESSAGE="Sorry, this video is currently not available.",ConfigLoader.prototype={initialize:function(){_.bindAll(this,"onConfigLoaded","onMediaGenLoaded","onError","onLoadError","getImage"),EventEmitter.convert(this)},shouldLoadMediaGen:!0,getConfigUrl:function(){var a=template(this.options.configURL||CONFIG_URL,this.options,{});return Url.setParameters(a,this.options.configParams)},load:function(){this.request=new Request(this.getConfigUrl(),this.onConfigLoaded,this.onLoadError)},getImage:function(a){if(!this.images&&this.config){var b=this.config.mediaGen;b&&(this.images=new Images(b.vmap.adBreaks,b.image))}return this.images?this.images.getImage(a):void 0},getMediaGenUrl:function(){var a=this.options.mediaGenURL||this.config[this.options.mediaGenProperty||"mediaGen"];if(a){var b=_.clone(this.options.mediaGenParams);_.each(this.config.overrideParams,function(a,c){b["UMBEPARAM"+c]=a}),a=Url.setParameters(template(a,this.config),b)}else this.onError(this.getErrorMessage("no media gen specified."));return a},onConfigLoaded:function(a){if(a.config&&(a=a.config),a.error)return void this.onError(this.getErrorMessage(a.error));if(this.config=Config.process(a,this.options),this.config.getImage=this.getImage,this.options.shouldLoadMediaGen){var b=this.getMediaGenUrl();b?this.request=new Request(b,this.onMediaGenLoaded,this.onLoadError):this.onError(this.getErrorMessage("no media gen specified."))}else this.sendReady()},onMediaGenLoaded:function(a){var b;try{a=MediaGen.process(a)}catch(c){b=!0,this.onError(c.name===MediaGen.MEDIA_GEN_ERROR?c.message:this.getErrorMessage(c))}b||(this.config.mediaGen=a,this.sendReady())},sendReady:function(){this.config=Config.prune(this.config,this.options),this.emit(Events.READY,{type:Events.READY,data:this.config,target:this})},onLoadError:function(a){this.onError(this.getErrorMessage("Error Loading:"+a))},onError:function(a){this.emit(Events.ERROR,{type:Events.ERROR,data:a,target:this})},getErrorMessage:function(){return ConfigLoader.DEFAULT_ERROR_MESSAGE},destroy:function(){this.request&&this.request.abort()}},ConfigLoader.version="0.6.0",ConfigLoader.build="Thu May 08 2014 13:04:18";var Request=function(a,b,c){var d=this.request=new XMLHttpRequest;d.open("GET",a,!0),d.setRequestHeader("Accept","application/json"),d.onload=function(){if(d.status>=200&&d.status<400){var a,e;try{a=JSON.parse(d.responseText)}catch(f){e=f}a?b(a):c(e)}else c(d.status)},d.onerror=function(){c(d.status)},d.send()};Request.prototype={abort:function(){this.request.abort()}};var EventEmitter={convert:function(a,b){return b={},a.on=function(c,d){return(b[c]=b[c]||[]).push(d),a},a.once=function(b,c){function d(){c.apply(a.off(b,d),arguments)}return d.h=c,a.on(b,d)},a.off=function(c,d){for(var e=b[c],f=0;d&&e&&e[f];f++)e[f]!==d&&e[f].h!==d||e.splice(f--,1);return f||delete b[c],a},a.emit=function(c){for(var d=b[c],e=0;d&&d[e];)d[e++].apply(a,d.slice.call(arguments,1));return a},a}},MediaGen={MEDIA_GEN_ERROR:"mediaGenError",getItem:function(a){return a&&a.item?a.item:a.video.item},isVideoItem:function(a){return _.isObject(a.vmap)||_.isObject(a.rendition)||_.isArray(a.rendition)},process:function(a){_.isString(a)&&(a=JSON.parse(a));var b,c=this.getItem(a.package);return _.isArray(c)?(b=_.find(c,this.isVideoItem),b&&(b.overlay=_.find(c,function(a){return"overlay"===a.placement}))):this.isVideoItem(c)&&(b=c),b||_.some(c,function(a){if("text"===a.type)throw{name:MediaGen.MEDIA_GEN_ERROR,message:a.text}}),b.vmap&&(b.vmap=VMAPParser.process(b.vmap)),b}},Segments={get:function(a,b){return Segments.adjustForAds(a,Segments.configureSegments(b))},configureSegments:function(a){var b=0,c=function(a){return Number(a.toString().match(/^\d+(?:\.\d{0,2})?/))};return _.map(a,function(a){return _.each(["contentDurationMs","keyframeIntervalSeconds"],function(b){a[b]=parseFloat(a[b],10)}),a.duration=c(a.contentDurationMs/1e3),a.startTime=c(b),a.endTime=c(b+a.duration),b+=a.duration,a})},adjustForAds:function(a,b){return _.each(a,function(a){_.each(b,function(b){a.startTime<=b.startTime&&(b.startTime+=a.duration,b.endTime+=a.duration)})}),b}},Images=function(a,b){this.segments=Segments.get(a,b)};Images.prototype={getImage:function(a){a=Math.floor(a);var b=_.find(this.segments,function(b){return a>=b.startTime&&a<b.endTime});if(b){b=_.clone(b);var c=Math.floor((a-b.startTime)/b.keyframeIntervalSeconds),d=new Array(5-c.toString().length).join("0");b.src=b.src.replace("{0:0000}",d+c)}return b}};var Config={whitelist:["feed","mediaGen","brightcove_mediagenRootURL","getImage","uri","geo","ref","type","group","device","network","chromeless","autoPlay","adFreeInterval","ccEnabled","useSegmentedScrubber","useNativeControls"],process:function(a){return a&&(a.adFreeInterval=a.timeSinceLastAd,_.isUndefined(a.adFreeInterval)&&(a.adFreeInterval=a.freewheelMinTimeBtwAds)),a},prune:function(a,b){return a?_.pick(a,this.whitelist.concat(b.whitelist||[])):void 0}},ConfigLoader=function(a){this.options=a||{},_.defaults(a,{shouldLoadMediaGen:!0,configParams:_.defaults(a.configParams||{},{returntype:"config",configtype:"vmap",uri:a.uri}),mediaGenParams:a.mediaGenParams||{}}),a.verboseErrorMessaging&&(this.getErrorMessage=_.identity),this.initialize.apply(this,arguments)},template=function(a,b){return a=a.replace(/\{{1,}/g,"{{").replace(/\}{1,}/g,"}}"),_.template(a,b,{interpolate:/\{\{(.+?)\}\}/g})},CONFIG_URL="http://media.mtvnservices.com/pmt/e1/access/index.html",Events=ConfigLoader.Events={READY:"ready",ERROR:"error"};ConfigLoader.DEFAULT_ERROR_MESSAGE="Sorry, this video is currently not available.",ConfigLoader.prototype={initialize:function(){_.bindAll(this,"onConfigLoaded","onMediaGenLoaded","onError","onLoadError","getImage"),EventEmitter.convert(this)},shouldLoadMediaGen:!0,getConfigUrl:function(){var a=template(this.options.configURL||CONFIG_URL,this.options,{});return Url.setParameters(a,this.options.configParams)},load:function(){this.request=new Request(this.getConfigUrl(),this.onConfigLoaded,this.onLoadError)},getImage:function(a){if(!this.images&&this.config){var b=this.config.mediaGen;b&&(this.images=new Images(b.vmap.adBreaks,b.image))}return this.images?this.images.getImage(a):void 0},getMediaGenUrl:function(){var a=this.options.mediaGenURL||this.config[this.options.mediaGenProperty||"mediaGen"];if(a){var b=_.clone(this.options.mediaGenParams);_.each(this.config.overrideParams,function(a,c){b["UMBEPARAM"+c]=a}),a=Url.setParameters(template(a,this.config),b)}else this.onError(this.getErrorMessage("no media gen specified."));return a},onConfigLoaded:function(a){if(a.config&&(a=a.config),a.error)return void this.onError(this.getErrorMessage(a.error));if(this.config=Config.process(a,this.options),this.config.getImage=this.getImage,this.options.shouldLoadMediaGen){var b=this.getMediaGenUrl();b?this.request=new Request(b,this.onMediaGenLoaded,this.onLoadError):this.onError(this.getErrorMessage("no media gen specified."))}else this.sendReady()},onMediaGenLoaded:function(a){var b;try{a=MediaGen.process(a)}catch(c){b=!0,this.onError(c.name===MediaGen.MEDIA_GEN_ERROR?c.message:this.getErrorMessage(c))}b||(this.config.mediaGen=a,this.sendReady())},sendReady:function(){this.config=Config.prune(this.config,this.options),this.emit(Events.READY,{type:Events.READY,data:this.config,target:this})},onLoadError:function(a){this.onError(this.getErrorMessage(a))},onError:function(a){this.emit(Events.ERROR,{type:Events.ERROR,data:a,target:this})},getErrorMessage:function(){return ConfigLoader.DEFAULT_ERROR_MESSAGE},destroy:function(){this.request&&this.request.abort()}},ConfigLoader.version="0.6.0",ConfigLoader.build="Thu May 01 2014 18:49:01";var Request=function(a,b,c){var d=this.request=new XMLHttpRequest;d.open("GET",a,!0),d.setRequestHeader("Accept","application/json"),d.onload=function(){if(d.status>=200&&d.status<400){var a,e;try{a=JSON.parse(d.responseText)}catch(f){e=f}a?b(a):c(e)}else c(d.status)},d.onerror=function(){c(d.status)},d.send()};Request.prototype={abort:function(){this.request.abort()}};var EventEmitter={convert:function(a,b){return b={},a.on=function(c,d){return(b[c]=b[c]||[]).push(d),a},a.once=function(b,c){function d(){c.apply(a.off(b,d),arguments)}return d.h=c,a.on(b,d)},a.off=function(c,d){for(var e=b[c],f=0;d&&e&&e[f];f++)e[f]!==d&&e[f].h!==d||e.splice(f--,1);return f||delete b[c],a},a.emit=function(c){for(var d=b[c],e=0;d&&d[e];)d[e++].apply(a,d.slice.call(arguments,1));return a},a}},MediaGen={MEDIA_GEN_ERROR:"mediaGenError",getItem:function(a){return a&&a.item?a.item:a.video.item},isVideoItem:function(a){return _.isObject(a.vmap)||_.isObject(a.rendition)||_.isArray(a.rendition)},process:function(a){_.isString(a)&&(a=JSON.parse(a));var b,c=this.getItem(a.package);return _.isArray(c)?(b=_.find(c,this.isVideoItem),b&&(b.overlay=_.find(c,function(a){return"overlay"===a.placement}))):this.isVideoItem(c)&&(b=c),b||_.some(c,function(a){if("text"===a.type)throw{name:MediaGen.MEDIA_GEN_ERROR,message:a.text}}),b.vmap&&(b.vmap=VMAPParser.process(b.vmap)),b}},Segments={get:function(a,b){return Segments.adjustForAds(a,Segments.configureSegments(b))},configureSegments:function(a){var b=0,c=function(a){return Number(a.toString().match(/^\d+(?:\.\d{0,2})?/))};return _.map(a,function(a){return _.each(["contentDurationMs","keyframeIntervalSeconds"],function(b){a[b]=parseFloat(a[b],10)}),a.duration=c(a.contentDurationMs/1e3),a.startTime=c(b),a.endTime=c(b+a.duration),b+=a.duration,a})},adjustForAds:function(a,b){return _.each(a,function(a){_.each(b,function(b){a.startTime<=b.startTime&&(b.startTime+=a.duration,b.endTime+=a.duration)})}),b}},Images=function(a,b){this.segments=Segments.get(a,b)};Images.prototype={getImage:function(a){a=Math.floor(a);var b=_.find(this.segments,function(b){return a>=b.startTime&&a<b.endTime});if(b){b=_.clone(b);var c=Math.floor((a-b.startTime)/b.keyframeIntervalSeconds),d=new Array(5-c.toString().length).join("0");b.src=b.src.replace("{0:0000}",d+c)}return b}};var Config={whitelist:["feed","mediaGen","brightcove_mediagenRootURL","getImage","uri","geo","ref","type","group","device","network","chromeless","autoPlay","adFreeInterval","ccEnabled","useSegmentedScrubber","useNativeControls"],process:function(a){return a&&(a.adFreeInterval=a.timeSinceLastAd,_.isUndefined(a.adFreeInterval)&&(a.adFreeInterval=a.freewheelMinTimeBtwAds)),a},prune:function(a,b){return a?_.pick(a,this.whitelist.concat(b.whitelist||[])):void 0}},ConfigLoader=function(a){this.options=a||{},_.defaults(a,{shouldLoadMediaGen:!0,configParams:_.defaults(a.configParams||{},{returntype:"config",configtype:"vmap",uri:a.uri}),mediaGenParams:a.mediaGenParams||{}}),a.verboseErrorMessaging&&(this.getErrorMessage=_.identity),this.initialize.apply(this,arguments)},template=function(a,b){return a=a.replace(/\{{1,}/g,"{{").replace(/\}{1,}/g,"}}"),_.template(a,b,{interpolate:/\{\{(.+?)\}\}/g})},CONFIG_URL="http://media.mtvnservices.com/pmt/e1/access/index.html",Events=ConfigLoader.Events={READY:"ready",ERROR:"error"};ConfigLoader.DEFAULT_ERROR_MESSAGE="Sorry, this video is currently not available.",ConfigLoader.prototype={initialize:function(){_.bindAll(this,"onConfigLoaded","onMediaGenLoaded","onError","onLoadError","getImage"),EventEmitter.convert(this)},shouldLoadMediaGen:!0,getConfigUrl:function(){var a=template(this.options.configURL||CONFIG_URL,this.options,{});return Url.setParameters(a,this.options.configParams)},load:function(){this.request=new Request(this.getConfigUrl(),this.onConfigLoaded,this.onLoadError)},getImage:function(a){if(!this.images&&this.config){var b=this.config.mediaGen;b&&(this.images=new Images(b.vmap.adBreaks,b.image))}return this.images?this.images.getImage(a):void 0},getMediaGenUrl:function(){var a=this.options.mediaGenURL||this.config[this.options.mediaGenProperty||"mediaGen"];if(a){var b=_.clone(this.options.mediaGenParams);_.each(this.config.overrideParams,function(a,c){b["UMBEPARAM"+c]=a}),a=Url.setParameters(template(a,this.config),b)}else this.onError(this.getErrorMessage("no media gen specified."));return a},onConfigLoaded:function(a){if(a.config&&(a=a.config),a.error)return void this.onError(this.getErrorMessage(a.error));if(this.config=Config.process(a,this.options),this.config.getImage=this.getImage,this.options.shouldLoadMediaGen){var b=this.getMediaGenUrl();b?this.request=new Request(b,this.onMediaGenLoaded,this.onLoadError):this.onError(this.getErrorMessage("no media gen specified."))}else this.sendReady()},onMediaGenLoaded:function(a){var b;try{a=MediaGen.process(a)}catch(c){b=!0,this.onError(c.name===MediaGen.MEDIA_GEN_ERROR?c.message:this.getErrorMessage(c))}b||(this.config.mediaGen=a,this.sendReady())},sendReady:function(){this.config=Config.prune(this.config,this.options),this.emit(Events.READY,{type:Events.READY,data:this.config,target:this})},onLoadError:function(a){this.onError(this.getErrorMessage(a))},onError:function(a){this.emit(Events.ERROR,{type:Events.ERROR,data:a,target:this})},getErrorMessage:function(){return ConfigLoader.DEFAULT_ERROR_MESSAGE},destroy:function(){this.request&&this.request.abort()}},ConfigLoader.version="0.6.0",ConfigLoader.build="Thu May 01 2014 18:47:15";var Request=function(a,b,c){var d=this.request=new XMLHttpRequest;d.open("GET",a,!0),d.setRequestHeader("Accept","application/json"),d.onload=function(){if(d.status>=200&&d.status<400){var a,e;try{a=JSON.parse(d.responseText)}catch(f){e=f}a?b(a):c(e)}else c(d.status)},d.onerror=function(){c(d.status)},d.send()};Request.prototype={abort:function(){this.request.abort()}};var EventEmitter={convert:function(a,b){return b={},a.on=function(c,d){return(b[c]=b[c]||[]).push(d),a},a.once=function(b,c){function d(){c.apply(a.off(b,d),arguments)}return d.h=c,a.on(b,d)},a.off=function(c,d){for(var e=b[c],f=0;d&&e&&e[f];f++)e[f]!==d&&e[f].h!==d||e.splice(f--,1);return f||delete b[c],a},a.emit=function(c){for(var d=b[c],e=0;d&&d[e];)d[e++].apply(a,d.slice.call(arguments,1));return a},a}},MediaGen={MEDIA_GEN_ERROR:"mediaGenError",getItem:function(a){return a&&a.item?a.item:a.video.item},isVideoItem:function(a){return _.isObject(a.vmap)||_.isObject(a.rendition)||_.isArray(a.rendition)},process:function(a){_.isString(a)&&(a=JSON.parse(a));var b,c=this.getItem(a.package);return _.isArray(c)?(b=_.find(c,this.isVideoItem),b&&(b.overlay=_.find(c,function(a){return"overlay"===a.placement}))):this.isVideoItem(c)&&(b=c),b||_.some(c,function(a){if("text"===a.type)throw{name:MediaGen.MEDIA_GEN_ERROR,message:a.text}}),b.vmap&&(b.vmap=VMAPParser.process(b.vmap)),b}},Segments={get:function(a,b){return Segments.adjustForAds(a,Segments.configureSegments(b))},configureSegments:function(a){var b=0,c=function(a){return Number(a.toString().match(/^\d+(?:\.\d{0,2})?/))};return _.map(a,function(a){return _.each(["contentDurationMs","keyframeIntervalSeconds"],function(b){a[b]=parseFloat(a[b],10)}),a.duration=c(a.contentDurationMs/1e3),delete a.contentDurationMs,a.startTime=c(b),a.endTime=c(b+a.duration),b+=a.duration,a})},adjustForAds:function(a,b){return _.each(a,function(a){_.each(b,function(b){a.startTime<=b.startTime&&(b.startTime+=a.duration,b.endTime+=a.duration)})}),b}},Images=function(a,b){this.segments=Segments.get(a,b)};Images.prototype={getImage:function(a){a=Math.floor(a);var b=_.find(this.segments,function(b){return a>=b.startTime&&a<b.endTime});return b&&(b=_.clone(b),b.src=b.src.replace("{0:0000}",Math.floor((a-b.startTime)/b.keyframeIntervalSeconds))),b}};var Config={whitelist:["feed","mediaGen","brightcove_mediagenRootURL","getImage","uri","geo","ref","type","group","device","network","chromeless","autoPlay","adFreeInterval","ccEnabled","useSegmentedScrubber","useNativeControls"],process:function(a){return a&&(a.adFreeInterval=a.timeSinceLastAd,_.isUndefined(a.adFreeInterval)&&(a.adFreeInterval=a.freewheelMinTimeBtwAds)),a},prune:function(a,b){return a?_.pick(a,this.whitelist.concat(b.whitelist||[])):void 0}},ConfigLoader=function(a){this.options=a||{},_.defaults(a,{shouldLoadMediaGen:!0,configParams:_.defaults(a.configParams||{},{returntype:"config",configtype:"vmap",uri:a.uri}),mediaGenParams:a.mediaGenParams||{}}),a.verboseErrorMessaging&&(this.getErrorMessage=_.identity),this.initialize.apply(this,arguments)},template=function(a,b){return a=a.replace(/\{{1,}/g,"{{").replace(/\}{1,}/g,"}}"),_.template(a,b,{interpolate:/\{\{(.+?)\}\}/g})},CONFIG_URL="http://media.mtvnservices.com/pmt/e1/access/index.html",Events=ConfigLoader.Events={READY:"ready",ERROR:"error"};ConfigLoader.DEFAULT_ERROR_MESSAGE="Sorry, this video is currently not available.",ConfigLoader.prototype={initialize:function(){_.bindAll(this,"onConfigLoaded","onMediaGenLoaded","onError","onLoadError","getImage"),EventEmitter.convert(this)},shouldLoadMediaGen:!0,getConfigUrl:function(){var a=template(this.options.configURL||CONFIG_URL,this.options,{});return Url.setParameters(a,this.options.configParams)},load:function(){this.request=new Request(this.getConfigUrl(),this.onConfigLoaded,this.onLoadError)},getImage:function(a){if(!this.images&&this.config){var b=this.config.mediaGen;b&&(this.images=new Images(b.vmap.adBreaks,b.image))}return this.images?this.images.getImage(a):void 0},getMediaGenUrl:function(){var a=this.options.mediaGenURL||this.config[this.options.mediaGenProperty||"mediaGen"];if(a){var b=_.clone(this.options.mediaGenParams);_.each(this.config.overrideParams,function(a,c){b["UMBEPARAM"+c]=a}),a=Url.setParameters(template(a,this.config),b)}else this.onError(this.getErrorMessage("no media gen specified."));return a},onConfigLoaded:function(a){if(a.config&&(a=a.config),a.error)return void this.onError(this.getErrorMessage(a.error));if(this.config=Config.process(a,this.options),this.config.getImage=this.getImage,this.options.shouldLoadMediaGen){var b=this.getMediaGenUrl();b?this.request=new Request(b,this.onMediaGenLoaded,this.onLoadError):this.onError(this.getErrorMessage("no media gen specified."))}else this.sendReady()},onMediaGenLoaded:function(a){var b;try{a=MediaGen.process(a)}catch(c){b=!0,this.onError(c.name===MediaGen.MEDIA_GEN_ERROR?c.message:this.getErrorMessage(c))}b||(this.config.mediaGen=a,this.sendReady())},sendReady:function(){this.config=Config.prune(this.config,this.options),this.emit(Events.READY,{type:Events.READY,data:this.config,target:this})},onLoadError:function(a){this.onError(this.getErrorMessage(a))},onError:function(a){this.emit(Events.ERROR,{type:Events.ERROR,data:a,target:this})},getErrorMessage:function(){return ConfigLoader.DEFAULT_ERROR_MESSAGE},destroy:function(){this.request&&this.request.abort()}},ConfigLoader.version="0.6.0",ConfigLoader.build="Thu May 01 2014 18:17:41";var Request=function(a,b,c){var d=this.request=new XMLHttpRequest;d.open("GET",a,!0),d.setRequestHeader("Accept","application/json"),d.onload=function(){if(d.status>=200&&d.status<400){var a,e;try{a=JSON.parse(d.responseText)}catch(f){e=f}a?b(a):c(e)}else c(d.status)},d.onerror=function(){c(d.status)},d.send()};Request.prototype={abort:function(){this.request.abort()}};var EventEmitter={convert:function(a,b){return b={},a.on=function(c,d){return(b[c]=b[c]||[]).push(d),a},a.once=function(b,c){function d(){c.apply(a.off(b,d),arguments)}return d.h=c,a.on(b,d)},a.off=function(c,d){for(var e=b[c],f=0;d&&e&&e[f];f++)e[f]!==d&&e[f].h!==d||e.splice(f--,1);return f||delete b[c],a},a.emit=function(c){for(var d=b[c],e=0;d&&d[e];)d[e++].apply(a,d.slice.call(arguments,1));return a},a}},MediaGen={MEDIA_GEN_ERROR:"mediaGenError",getItem:function(a){return a&&a.item?a.item:a.video.item},isVideoItem:function(a){return _.isObject(a.vmap)||_.isObject(a.rendition)||_.isArray(a.rendition)},process:function(a){_.isString(a)&&(a=JSON.parse(a));var b,c=this.getItem(a.package);return _.isArray(c)?(b=_.find(c,this.isVideoItem),b&&(b.overlay=_.find(c,function(a){return"overlay"===a.placement}))):this.isVideoItem(c)&&(b=c),b||_.some(c,function(a){if("text"===a.type)throw{name:MediaGen.MEDIA_GEN_ERROR,message:a.text}}),b.vmap&&(b.vmap=VMAPParser.process(b.vmap)),b}},Segments={get:function(a,b){return Segments.adjustForAds(a,Segments.configureSegments(b))},configureSegments:function(a){var b=0;return _.map(a,function(a){return a.startTime=b,a.endTime=b+a.duration,a.keyframeIntervalSeconds=parseFloat(a.keyframeIntervalSeconds,10),b+=a.duration,a})},adjustForAds:function(a,b){return _.each(a,function(a){_.each(b,function(b){a.startTime<=b.startTime&&(b.startTime+=a.duration,b.endTime+=a.duration)})}),b}},Images=function(a,b){this.segments=Segments.get(a,b)};Images.prototype={getImage:function(a){a=Math.floor(a);var b=_.find(this.segments,function(b){return a>=b.startTime&&a<b.endTime});return b&&(b=_.clone(b),b.src=b.src.replace("{0:0000}",Math.floor((a-b.startTime)/b.keyframeIntervalSeconds))),b}};var Config={whitelist:["feed","mediaGen","brightcove_mediagenRootURL","uri","geo","ref","type","group","device","network","chromeless","autoPlay","adFreeInterval","ccEnabled","useSegmentedScrubber","useNativeControls"],process:function(a){return a&&(a.adFreeInterval=a.timeSinceLastAd,_.isUndefined(a.adFreeInterval)&&(a.adFreeInterval=a.freewheelMinTimeBtwAds)),a},prune:function(a,b){return a?_.pick(a,this.whitelist.concat(b.whitelist||[])):void 0}},ConfigLoader=function(a){this.options=a||{},_.defaults(a,{shouldLoadMediaGen:!0,configParams:_.defaults(a.configParams||{},{returntype:"config",configtype:"vmap",uri:a.uri}),mediaGenParams:a.mediaGenParams||{}}),a.verboseErrorMessaging&&(this.getErrorMessage=_.identity),this.initialize.apply(this,arguments)},template=function(a,b){return a=a.replace(/\{{1,}/g,"{{").replace(/\}{1,}/g,"}}"),_.template(a,b,{interpolate:/\{\{(.+?)\}\}/g})},CONFIG_URL="http://media.mtvnservices.com/pmt/e1/access/index.html",Events=ConfigLoader.Events={READY:"ready",ERROR:"error"};ConfigLoader.DEFAULT_ERROR_MESSAGE="Sorry, this video is currently not available.",ConfigLoader.prototype={initialize:function(){_.bindAll(this,"onConfigLoaded","onMediaGenLoaded","onError","onLoadError"),EventEmitter.convert(this)
},shouldLoadMediaGen:!0,getConfigUrl:function(){var a=template(this.options.configURL||CONFIG_URL,this.options,{});return Url.setParameters(a,this.options.configParams)},load:function(){this.request=new Request(this.getConfigUrl(),this.onConfigLoaded,this.onLoadError)},getImage:function(a){if(!this.images&&this.config){var b=this.config.mediaGen;b&&(this.images=new Images(b.vmap.adBreaks,b.images))}return this.images?this.images.getImage(a):void 0},getMediaGenUrl:function(){var a=this.options.mediaGenURL||this.config[this.options.mediaGenProperty||"mediaGen"];if(a){var b=_.clone(this.options.mediaGenParams);_.each(this.config.overrideParams,function(a,c){b["UMBEPARAM"+c]=a}),a=Url.setParameters(template(a,this.config),b)}else this.onError(this.getErrorMessage("no media gen specified."));return a},onConfigLoaded:function(a){if(a.config&&(a=a.config),a.error)return void this.onError(this.getErrorMessage(a.error));if(this.config=Config.process(a,this.options),this.options.shouldLoadMediaGen){var b=this.getMediaGenUrl();b?this.request=new Request(b,this.onMediaGenLoaded,this.onLoadError):this.onError(this.getErrorMessage("no media gen specified."))}else this.sendReady()},onMediaGenLoaded:function(a){var b;try{a=MediaGen.process(a)}catch(c){b=!0,this.onError(c.name===MediaGen.MEDIA_GEN_ERROR?c.message:this.getErrorMessage(c))}b||(this.config.mediaGen=a,this.sendReady())},sendReady:function(){this.config=Config.prune(this.config,this.options),this.emit(Events.READY,{type:Events.READY,data:this.config,target:this})},onLoadError:function(a){this.onError(this.getErrorMessage(a))},onError:function(a){this.emit(Events.ERROR,{type:Events.ERROR,data:a,target:this})},getErrorMessage:function(){return ConfigLoader.DEFAULT_ERROR_MESSAGE},destroy:function(){this.request&&this.request.abort()}},ConfigLoader.version="0.6.0",ConfigLoader.build="Thu May 01 2014 17:11:04";