!function(a,b){"object"==typeof exports?module.exports=b(require("lodash")):"function"==typeof define&&define.amd&&define(["lodash"],b)}(this,function(a){function b(a){return Math.round(100*a)/100}function c(a){var c=a.split(/\D/);return 60*+c[0]*60+60*+c[1]+ +c[2]+(c[3]?parseFloat("."+b(c[3])):0)}function d(b){a.isString(b)&&(b=parseFloat(b,10));var c=Math.floor(b/3600),d=b%3600,e=Math.floor(d/60),f=d%60;f=Math.round(100*f)/100,c>12&&(c-=12),10>c&&(c="0"+c),10>e&&(e="0"+e),10>f&&(f="0"+f);var g=c+":"+e+":"+f;return g}function e(b,c){var d=[];return(a.isObject(b)||a.isArray(b))&&a.each(b,function(b,f){f===c&&d.push(b),(a.isObject(b)||a.isArray(b))&&(d=d.concat(e(b,c)))}),d}function f(a){var b=e(a,"Duration");return c(b[0])}function g(a){var b=e(a,"ClickThrough");return b.length>0?b[0]:null}function h(a,b,c){if(0===b.indexOf("xmlns"))delete c[b];else{var d=b.split(":");0===b.indexOf("@")||0===b.indexOf("#")?(c[b.slice(1)]=a,delete c[b]):2===d.length&&(c[d[1]]=a,delete c[b])}}function i(b){a.each(a.rest(a.toArray(arguments)),function(c){var d=b[c];a.isArray(d)?a.each(d,function(b){a.each(b,h)}):a.each(d,h)})}function j(a){return"start"===a?k:"end"===a?m:l}var k="preroll",l="midroll",m="postroll",n={find:e,clean:h,process:function(b){function d(a,b){switch(a){case"firstQuartile":return b/4;case"midpoint":return b/2;case"thirdQuartile":return 3*b/4;case"complete":return b}}function k(b,c,d){var i=o+parseFloat(d,10);"end"===d&&(i=m-p);var k=[];return a.each(c,function(c){var d=c.AdSource;a.each(d,h);var m=f(d.VASTData.VAST.Ad),n=a.isEmpty(k)?i:a.last(k)+1,p=n+m;o+=m,k=k.concat(a.range(Math.ceil(n),Math.floor(p))),l(d.id,m,a.flatten(e(d,"Tracking")),n);var q={type:j(c.timeOffset),breakId:d.id,startTime:n,endTime:p,timeOffset:c.timeOffset,duration:m},r=g(d);r&&(q.clickThrough=r),b.push(q)}),q.push(a.flatten(k)),b}function l(b,c,e,f){a.each(e,function(e){a.each(e,h);var g=parseFloat(e.offset,10),i={breakId:b,event:e.event,url:e.text};isNaN(g)&&(g=d(e.event,c)),isNaN(g)||(i.timeToFire=Math.round(f+g)),n.push(i)})}if(!b)return{error:"vmap undefined"};var m,n=[],o=0,p=0,q=[];b=b["vmap:VMAP"],a.each(b,h),i(b,"AdBreak","Extensions"),i(b.Extensions,"unicornOnce","requestParameters"),m=parseFloat(b.Extensions.unicornOnce.payloadlength,10);var r=a.reduce(a.groupBy(b.AdBreak,function(a){return"start"===a.timeOffset?0:"end"===a.timeOffset?(p+=f(a),"end"):c(a.timeOffset)}),k,[]);return{uri:b.Extensions.unicornOnce.contenturi,totalDuration:m,trackers:n,adBreaks:r}},rawTime:c,formatTime:d,version:"0.0.0",build:"02/18/2014 02:52:27 PM"};return n});