var ConfigLoader=function(a,b,c){var d=function(a,b,c){var d=this.request=new XMLHttpRequest;d.open("GET",a,!0),d.onload=function(){if(d.status>=200&&d.status<400){var a,e;try{a=JSON.parse(d.responseText)}catch(f){e=f}a?b(a):c(e)}else c(d.status)},d.onerror=function(){c(d.status)},d.send()};d.prototype={abort:function(){this.request.abort()}};var e={convert:function(a,b){return b={},a.on=function(c,d){return(b[c]=b[c]||[]).push(d),a},a.once=function(b,c){function d(){c.apply(a.off(b,d),arguments)}return d.h=c,a.on(b,d)},a.off=function(c,d){for(var e=b[c],f=0;d&&e&&e[f];f++)e[f]!==d&&e[f].h!==d||e.splice(f--,1);return f||delete b[c],a},a.emit=function(c){for(var d=b[c],e=0;d&&d[e];)d[e++].apply(a,d.slice.call(arguments,1));return a},a}},f={getItem:function(a){return a&&a.item?a.item:a.video.item},process:function(c){a.isString(c)&&(c=JSON.parse(c));var d,e=this.getItem(c.package);return a.isArray(e)?d=a.find(e,function(b){return a.isObject(b.vmap)}):a.isObject(e)&&e.vmap&&(d=e),d.vmap=b.process(d.vmap),d}},g={whitelist:["feed","mediaGen","uri","geo","ref","type","group","device","network","chromeless","autoPlay","adFreeInterval","ccEnabled","useSegmentedScrubber","useNativeControls"],process:function(b,c){return b&&(b.adFreeInterval=b.timeSinceLastAd,a.isUndefined(b.adFreeInterval)&&(b.adFreeInterval=b.freewheelMinTimeBtwAds),b=a.pick(b,this.whitelist.concat(c.whitelist||[]))),b}},h=function(b){this.options=b||{},a.defaults(b,{feed:!0,mediaGen:!1,configParams:a.defaults(b.configParams||{},{returntype:"config",configtype:"vmap",uri:b.uri})}),this.initialize.apply(this,arguments)},i=function(b,c){return b=b.replace(/\{{1,}/g,"{{").replace(/\}{1,}/g,"}}"),a.template(b,c,{interpolate:/\{\{(.+?)\}\}/g})},j="http://media.mtvnservices-q.mtvi.com/pmt/e1/access/index.html",k=h.Events={READY:"ready",ERROR:"error"};return h.prototype={initialize:function(){a.bindAll(this,"onConfigLoaded","onMediaGenLoaded","onError"),e.convert(this)},load:function(){var a=i(this.options.configURL||j,this.options,{});a=c.setParameters(a,this.options.configParams),this.request=new d(a,this.onConfigLoaded,this.onError)},onConfigLoaded:function(a){a.config&&(a=a.config),this.config=g.process(a,this.options);var b=this.options.mediaGenURL||a[this.options.mediaGenProperty||"mediaGen"];b?(b=c.setParameters(i(b,a),this.options.mediaGenParams),this.request=new d(b,this.onMediaGenLoaded,this.onError)):this.onError("no media gen specified")},onMediaGenLoaded:function(a){var b;try{a=f.process(a)}catch(c){b=!0,this.onError(c)}b||(this.config.mediaGen=a,this.emit(k.READY,{type:k.READY,data:this.config,target:this}))},onError:function(a){this.emit(k.ERROR,{type:k.ERROR,data:a,target:this})},destroy:function(){this.request&&this.request.abort()}},h.version="0.5.0",h.build="Tue Apr 01 2014 15:02:39",h}(_,VMAPParser,Url);